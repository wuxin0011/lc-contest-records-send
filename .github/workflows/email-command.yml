name: Execute Email Command

on:
  repository_dispatch:
    types: [email-command]

jobs:
  process-command:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Process command
        env:
          COMMAND: ${{ github.event.client_payload.command }}
          SENDER: ${{ github.event.client_payload.from }}
        run: |
          echo "ğŸ“¨ æ”¶åˆ°é‚®ä»¶å‘½ä»¤"
          echo "å‘ä»¶äºº: $SENDER"
          echo "å‘½ä»¤: $COMMAND"

          # è§£æå‘½ä»¤å‚æ•°
          if [[ "$COMMAND" =~ @lc\ (-?[0-9]+)\ (-?[0-9]+) ]]; then
            num1=${BASH_REMATCH[1]}
            num2=${BASH_REMATCH[2]}
            
            echo "ğŸ” è§£æåˆ°å‚æ•°: $num1 å’Œ $num2"
            
            # åœ¨è¿™é‡Œæ‰§è¡Œä½ çš„å…·ä½“æ“ä½œ
            # ä¾‹å¦‚ï¼šè¿è¡Œè„šæœ¬ã€æ›´æ–°æ–‡ä»¶ã€è§¦å‘éƒ¨ç½²ç­‰
            
            # ç¤ºä¾‹ï¼šè®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œ
            result=$((num1 + num2))
            echo "ğŸ“Š è®¡ç®—ç»“æœ: $num1 + $num2 = $result"
          else
            echo "âŒ å‘½ä»¤æ ¼å¼æ— æ•ˆ"
            exit 1
          fi

      - name: Send notification
        if: success()
        run: |
          echo "âœ… å‘½ä»¤æ‰§è¡ŒæˆåŠŸ: ${{ github.event.client_payload.command }}"